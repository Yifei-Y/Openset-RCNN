from detectron2.data import DatasetCatalog, MetadataCatalog
from detectron2.data.datasets import load_voc_instances
from detectron2.data.datasets.builtin_meta import COCO_CATEGORIES

VOC_COCO_CATEGORIES = [
    # VOC
    "aeroplane", "bicycle", "bird", "boat", "bottle", "bus", "car", "cat",
    "chair", "cow", "diningtable", "dog", "horse", "motorbike", "person",
    "pottedplant", "sheep", "sofa", "train", "tvmonitor",
    # COCO-20-40
    "truck", "traffic light", "fire hydrant", "stop sign", "parking meter",
    "bench", "elephant", "bear", "zebra", "giraffe",
    "backpack", "umbrella", "handbag", "tie", "suitcase",
    "microwave", "oven", "toaster", "sink", "refrigerator",
    # COCO-40-60
    "frisbee", "skis", "snowboard", "sports ball", "kite",
    "baseball bat", "baseball glove", "skateboard", "surfboard", "tennis racket",
    "banana", "apple", "sandwich", "orange", "broccoli",
    "carrot", "hot dog", "pizza", "donut", "cake",
    # COCO-60-80
    "bed", "toilet", "laptop", "mouse",
    "remote", "keyboard", "cell phone", "book", "clock",
    "vase", "scissors", "teddy bear", "hair drier", "toothbrush",
    "wine glass", "cup", "fork", "knife", "spoon", "bowl",
    # Unknown
    "unknown",
]


def register_voc_coco(name, dirname, split, year):
    class_names = VOC_COCO_CATEGORIES
    DatasetCatalog.register(
        name, lambda: load_voc_instances(dirname, split, class_names))
    MetadataCatalog.get(name).set(
        thing_classes=list(class_names), dirname=dirname, year=year, split=split
    )
    ###
    meta = MetadataCatalog.get(name)
    id_map = {v: i for i, v in enumerate(range(len(VOC_COCO_CATEGORIES)))}
    meta.thing_dataset_id_to_contiguous_id = id_map